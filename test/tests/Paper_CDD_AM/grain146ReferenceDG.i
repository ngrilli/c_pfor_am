# reference simulation in figure 6 of
# Daijun Hu, Nicolò Grilli, Wentao Yan
# Dislocation structures formation induced by thermal stress in additive manufacturing: 
# Multiscale crystal plasticity modeling of dislocation transport
# Journal of the Mechanics and Physics of Solids 173 (2023) 105235
# https://www.sciencedirect.com/science/article/pii/S002250962300039X

[Mesh]
  type = GeneratedMesh
  dim = 3
  nx = 100
  ny = 100
  nz = 1
  xmax = 40.0
  ymax = 40.0
  zmax = 0.4
  elem_type = HEX8
  displacements = 'disp_x disp_y disp_z'
[]

[GlobalParams]
  displacements = 'disp_x disp_y disp_z'
[]

[Variables]
  [./disp_x]
    order = FIRST
    family = LAGRANGE
  [../]

  [./disp_y]
    order = FIRST
    family = LAGRANGE
  [../]

  [./disp_z]
    order = FIRST
    family = LAGRANGE
  [../]
  
  [./q_t] # curvature density q_t in the paper
    order = FIRST
    family = LAGRANGE
    [./InitialCondition]
      type = DislocationLoopsIC
centrex = '26.99 0.84 33.50 32.01 33.89 0.38 13.22 38.14 20.74 18.51 17.23 37.53 17.67 28.50 23.67 33.03 18.55 12.84 39.09 26.42 11.91 12.41 18.35 2.77 31.19 21.72 37.43 23.28 33.87 14.07 22.73 2.95 14.15 9.69 31.34 24.61 33.76 20.56 7.19 26.10 35.10 31.11 17.48 36.98 31.47 33.48 26.21 14.70 2.99 4.80 12.73 15.51 30.42 23.34 7.81 8.86 22.75 1.98 6.48 39.10 12.79 34.40 39.41 30.12 1.55 6.53 11.46 33.96 4.41 3.73 33.37 11.12 5.82 26.49 14.74 6.49 14.71 37.14 32.41 10.85 19.54 5.88 20.34 28.80 13.92 20.73 39.35 2.40 36.02 6.97 35.80 24.72 14.19 11.93 29.57 20.08 24.32 17.23 17.06 18.77 9.29 38.00 16.48 0.86 29.11 16.66 20.99 6.37 35.27 33.88 12.40 3.67 23.44 39.27 33.19 38.48 30.82 8.59 0.10 27.05 16.56 3.17 39.68 18.88 24.36 1.00 16.78 8.37 13.09 8.65 13.85 5.28 19.96 22.18 3.27 5.17 33.02 10.69 4.92 34.49 34.57 21.97 19.66 10.09 4.93 11.14 5.34 39.45 33.32 14.46 0.06 31.86 20.65 12.62 6.25 26.26 19.82 13.61 39.94 35.02 19.43 27.74 39.79 33.73 15.55 22.29 9.63 31.61 2.94 28.69 32.18 11.01 13.90 35.38 38.19 2.54 29.55 37.03 15.95 16.36 14.61 34.24 37.85 27.11 37.92 3.07 37.93 3.07 27.83 6.88 26.80 14.46 9.65 18.84 4.63 39.52 11.47 37.44 28.57 20.53 '
centrey = '19.11 18.88 14.01 2.68 29.91 2.27 11.43 12.08 31.40 16.86 35.90 2.22 21.13 29.91 26.98 39.63 4.85 19.15 29.19 30.16 10.84 2.40 4.72 17.03 11.69 30.39 25.11 31.48 15.32 8.42 25.39 31.40 22.72 37.13 14.46 24.26 29.84 0.19 10.02 19.00 22.95 2.03 39.53 10.79 5.38 7.74 33.26 33.50 1.39 1.48 20.74 33.83 12.91 9.68 22.58 4.80 33.10 24.13 5.53 22.23 26.23 19.87 37.75 0.73 20.53 28.26 3.70 37.75 8.02 1.12 25.65 21.27 4.56 13.00 18.03 21.69 5.26 20.45 1.57 24.85 16.27 38.31 37.20 35.81 0.23 33.90 14.64 8.11 24.40 8.39 37.69 31.87 10.46 17.44 18.07 17.68 30.46 34.94 8.51 1.70 15.58 18.80 35.11 26.48 37.29 27.90 35.72 37.89 18.10 39.11 7.90 31.86 1.30 4.10 20.58 16.64 8.33 11.30 35.49 35.37 28.34 7.05 20.94 5.08 6.56 31.04 38.80 39.82 14.25 10.27 6.75 36.09 18.26 33.26 10.14 33.30 0.87 1.49 22.61 7.84 33.06 33.37 23.99 33.13 33.38 36.16 39.29 4.98 20.87 27.44 4.22 8.93 22.07 23.24 6.60 3.02 0.52 25.16 20.51 0.65 4.51 5.20 15.24 29.04 24.96 7.19 14.36 34.11 15.94 18.03 22.12 22.08 1.80 3.17 9.40 19.64 12.94 34.28 2.23 2.39 34.04 34.69 37.59 8.04 13.43 30.88 26.44 34.46 25.50 11.11 17.96 34.73 17.03 20.45 12.25 17.69 28.54 15.97 14.32 7.44 '
radii = '3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 '
width = '1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 '
rho_max = '0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 '
      variable_type = 'qtot'
	  slip_sys_index = 0
	  read_prop_user_object = prop_read
	  slip_sys_file_name = 'input_slip_sys.txt' # no need to normalize vectors
	  nss = 12
    [../]
  [../]
  
  [./rho_t] # rho_t in the paper
    order = FIRST
    family = LAGRANGE
    [./InitialCondition]
      type = DislocationLoopsIC
centrex = '26.99 0.84 33.50 32.01 33.89 0.38 13.22 38.14 20.74 18.51 17.23 37.53 17.67 28.50 23.67 33.03 18.55 12.84 39.09 26.42 11.91 12.41 18.35 2.77 31.19 21.72 37.43 23.28 33.87 14.07 22.73 2.95 14.15 9.69 31.34 24.61 33.76 20.56 7.19 26.10 35.10 31.11 17.48 36.98 31.47 33.48 26.21 14.70 2.99 4.80 12.73 15.51 30.42 23.34 7.81 8.86 22.75 1.98 6.48 39.10 12.79 34.40 39.41 30.12 1.55 6.53 11.46 33.96 4.41 3.73 33.37 11.12 5.82 26.49 14.74 6.49 14.71 37.14 32.41 10.85 19.54 5.88 20.34 28.80 13.92 20.73 39.35 2.40 36.02 6.97 35.80 24.72 14.19 11.93 29.57 20.08 24.32 17.23 17.06 18.77 9.29 38.00 16.48 0.86 29.11 16.66 20.99 6.37 35.27 33.88 12.40 3.67 23.44 39.27 33.19 38.48 30.82 8.59 0.10 27.05 16.56 3.17 39.68 18.88 24.36 1.00 16.78 8.37 13.09 8.65 13.85 5.28 19.96 22.18 3.27 5.17 33.02 10.69 4.92 34.49 34.57 21.97 19.66 10.09 4.93 11.14 5.34 39.45 33.32 14.46 0.06 31.86 20.65 12.62 6.25 26.26 19.82 13.61 39.94 35.02 19.43 27.74 39.79 33.73 15.55 22.29 9.63 31.61 2.94 28.69 32.18 11.01 13.90 35.38 38.19 2.54 29.55 37.03 15.95 16.36 14.61 34.24 37.85 27.11 37.92 3.07 37.93 3.07 27.83 6.88 26.80 14.46 9.65 18.84 4.63 39.52 11.47 37.44 28.57 20.53 '
centrey = '19.11 18.88 14.01 2.68 29.91 2.27 11.43 12.08 31.40 16.86 35.90 2.22 21.13 29.91 26.98 39.63 4.85 19.15 29.19 30.16 10.84 2.40 4.72 17.03 11.69 30.39 25.11 31.48 15.32 8.42 25.39 31.40 22.72 37.13 14.46 24.26 29.84 0.19 10.02 19.00 22.95 2.03 39.53 10.79 5.38 7.74 33.26 33.50 1.39 1.48 20.74 33.83 12.91 9.68 22.58 4.80 33.10 24.13 5.53 22.23 26.23 19.87 37.75 0.73 20.53 28.26 3.70 37.75 8.02 1.12 25.65 21.27 4.56 13.00 18.03 21.69 5.26 20.45 1.57 24.85 16.27 38.31 37.20 35.81 0.23 33.90 14.64 8.11 24.40 8.39 37.69 31.87 10.46 17.44 18.07 17.68 30.46 34.94 8.51 1.70 15.58 18.80 35.11 26.48 37.29 27.90 35.72 37.89 18.10 39.11 7.90 31.86 1.30 4.10 20.58 16.64 8.33 11.30 35.49 35.37 28.34 7.05 20.94 5.08 6.56 31.04 38.80 39.82 14.25 10.27 6.75 36.09 18.26 33.26 10.14 33.30 0.87 1.49 22.61 7.84 33.06 33.37 23.99 33.13 33.38 36.16 39.29 4.98 20.87 27.44 4.22 8.93 22.07 23.24 6.60 3.02 0.52 25.16 20.51 0.65 4.51 5.20 15.24 29.04 24.96 7.19 14.36 34.11 15.94 18.03 22.12 22.08 1.80 3.17 9.40 19.64 12.94 34.28 2.23 2.39 34.04 34.69 37.59 8.04 13.43 30.88 26.44 34.46 25.50 11.11 17.96 34.73 17.03 20.45 12.25 17.69 28.54 15.97 14.32 7.44 '
radii = '3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 '
width = '1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 '
rho_max = '0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 '
      variable_type = 'rhotot'
	  slip_sys_index = 0
	  read_prop_user_object = prop_read
	  slip_sys_file_name = 'input_slip_sys.txt' # no need to normalize vectors
	  nss = 12
    [../]
  [../]
  
  [./rho_gnd_edge] # rho_x in the paper
    order = FIRST
    family = LAGRANGE
    [./InitialCondition]
      type = DislocationLoopsIC
centrex = '26.99 0.84 33.50 32.01 33.89 0.38 13.22 38.14 20.74 18.51 17.23 37.53 17.67 28.50 23.67 33.03 18.55 12.84 39.09 26.42 11.91 12.41 18.35 2.77 31.19 21.72 37.43 23.28 33.87 14.07 22.73 2.95 14.15 9.69 31.34 24.61 33.76 20.56 7.19 26.10 35.10 31.11 17.48 36.98 31.47 33.48 26.21 14.70 2.99 4.80 12.73 15.51 30.42 23.34 7.81 8.86 22.75 1.98 6.48 39.10 12.79 34.40 39.41 30.12 1.55 6.53 11.46 33.96 4.41 3.73 33.37 11.12 5.82 26.49 14.74 6.49 14.71 37.14 32.41 10.85 19.54 5.88 20.34 28.80 13.92 20.73 39.35 2.40 36.02 6.97 35.80 24.72 14.19 11.93 29.57 20.08 24.32 17.23 17.06 18.77 9.29 38.00 16.48 0.86 29.11 16.66 20.99 6.37 35.27 33.88 12.40 3.67 23.44 39.27 33.19 38.48 30.82 8.59 0.10 27.05 16.56 3.17 39.68 18.88 24.36 1.00 16.78 8.37 13.09 8.65 13.85 5.28 19.96 22.18 3.27 5.17 33.02 10.69 4.92 34.49 34.57 21.97 19.66 10.09 4.93 11.14 5.34 39.45 33.32 14.46 0.06 31.86 20.65 12.62 6.25 26.26 19.82 13.61 39.94 35.02 19.43 27.74 39.79 33.73 15.55 22.29 9.63 31.61 2.94 28.69 32.18 11.01 13.90 35.38 38.19 2.54 29.55 37.03 15.95 16.36 14.61 34.24 37.85 27.11 37.92 3.07 37.93 3.07 27.83 6.88 26.80 14.46 9.65 18.84 4.63 39.52 11.47 37.44 28.57 20.53 '
centrey = '19.11 18.88 14.01 2.68 29.91 2.27 11.43 12.08 31.40 16.86 35.90 2.22 21.13 29.91 26.98 39.63 4.85 19.15 29.19 30.16 10.84 2.40 4.72 17.03 11.69 30.39 25.11 31.48 15.32 8.42 25.39 31.40 22.72 37.13 14.46 24.26 29.84 0.19 10.02 19.00 22.95 2.03 39.53 10.79 5.38 7.74 33.26 33.50 1.39 1.48 20.74 33.83 12.91 9.68 22.58 4.80 33.10 24.13 5.53 22.23 26.23 19.87 37.75 0.73 20.53 28.26 3.70 37.75 8.02 1.12 25.65 21.27 4.56 13.00 18.03 21.69 5.26 20.45 1.57 24.85 16.27 38.31 37.20 35.81 0.23 33.90 14.64 8.11 24.40 8.39 37.69 31.87 10.46 17.44 18.07 17.68 30.46 34.94 8.51 1.70 15.58 18.80 35.11 26.48 37.29 27.90 35.72 37.89 18.10 39.11 7.90 31.86 1.30 4.10 20.58 16.64 8.33 11.30 35.49 35.37 28.34 7.05 20.94 5.08 6.56 31.04 38.80 39.82 14.25 10.27 6.75 36.09 18.26 33.26 10.14 33.30 0.87 1.49 22.61 7.84 33.06 33.37 23.99 33.13 33.38 36.16 39.29 4.98 20.87 27.44 4.22 8.93 22.07 23.24 6.60 3.02 0.52 25.16 20.51 0.65 4.51 5.20 15.24 29.04 24.96 7.19 14.36 34.11 15.94 18.03 22.12 22.08 1.80 3.17 9.40 19.64 12.94 34.28 2.23 2.39 34.04 34.69 37.59 8.04 13.43 30.88 26.44 34.46 25.50 11.11 17.96 34.73 17.03 20.45 12.25 17.69 28.54 15.97 14.32 7.44 '
radii = '3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 '
width = '1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 '
rho_max = '0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 '
      variable_type = 'rhoedgegnd'
	  slip_sys_index = 0
	  read_prop_user_object = prop_read
	  slip_sys_file_name = 'input_slip_sys.txt' # no need to normalize vectors
	  nss = 12
    [../]
  [../]
  
  [./rho_gnd_screw] # rho_x in the paper
    order = FIRST
    family = LAGRANGE
    [./InitialCondition]
      type = DislocationLoopsIC
centrex = '26.99 0.84 33.50 32.01 33.89 0.38 13.22 38.14 20.74 18.51 17.23 37.53 17.67 28.50 23.67 33.03 18.55 12.84 39.09 26.42 11.91 12.41 18.35 2.77 31.19 21.72 37.43 23.28 33.87 14.07 22.73 2.95 14.15 9.69 31.34 24.61 33.76 20.56 7.19 26.10 35.10 31.11 17.48 36.98 31.47 33.48 26.21 14.70 2.99 4.80 12.73 15.51 30.42 23.34 7.81 8.86 22.75 1.98 6.48 39.10 12.79 34.40 39.41 30.12 1.55 6.53 11.46 33.96 4.41 3.73 33.37 11.12 5.82 26.49 14.74 6.49 14.71 37.14 32.41 10.85 19.54 5.88 20.34 28.80 13.92 20.73 39.35 2.40 36.02 6.97 35.80 24.72 14.19 11.93 29.57 20.08 24.32 17.23 17.06 18.77 9.29 38.00 16.48 0.86 29.11 16.66 20.99 6.37 35.27 33.88 12.40 3.67 23.44 39.27 33.19 38.48 30.82 8.59 0.10 27.05 16.56 3.17 39.68 18.88 24.36 1.00 16.78 8.37 13.09 8.65 13.85 5.28 19.96 22.18 3.27 5.17 33.02 10.69 4.92 34.49 34.57 21.97 19.66 10.09 4.93 11.14 5.34 39.45 33.32 14.46 0.06 31.86 20.65 12.62 6.25 26.26 19.82 13.61 39.94 35.02 19.43 27.74 39.79 33.73 15.55 22.29 9.63 31.61 2.94 28.69 32.18 11.01 13.90 35.38 38.19 2.54 29.55 37.03 15.95 16.36 14.61 34.24 37.85 27.11 37.92 3.07 37.93 3.07 27.83 6.88 26.80 14.46 9.65 18.84 4.63 39.52 11.47 37.44 28.57 20.53 '
centrey = '19.11 18.88 14.01 2.68 29.91 2.27 11.43 12.08 31.40 16.86 35.90 2.22 21.13 29.91 26.98 39.63 4.85 19.15 29.19 30.16 10.84 2.40 4.72 17.03 11.69 30.39 25.11 31.48 15.32 8.42 25.39 31.40 22.72 37.13 14.46 24.26 29.84 0.19 10.02 19.00 22.95 2.03 39.53 10.79 5.38 7.74 33.26 33.50 1.39 1.48 20.74 33.83 12.91 9.68 22.58 4.80 33.10 24.13 5.53 22.23 26.23 19.87 37.75 0.73 20.53 28.26 3.70 37.75 8.02 1.12 25.65 21.27 4.56 13.00 18.03 21.69 5.26 20.45 1.57 24.85 16.27 38.31 37.20 35.81 0.23 33.90 14.64 8.11 24.40 8.39 37.69 31.87 10.46 17.44 18.07 17.68 30.46 34.94 8.51 1.70 15.58 18.80 35.11 26.48 37.29 27.90 35.72 37.89 18.10 39.11 7.90 31.86 1.30 4.10 20.58 16.64 8.33 11.30 35.49 35.37 28.34 7.05 20.94 5.08 6.56 31.04 38.80 39.82 14.25 10.27 6.75 36.09 18.26 33.26 10.14 33.30 0.87 1.49 22.61 7.84 33.06 33.37 23.99 33.13 33.38 36.16 39.29 4.98 20.87 27.44 4.22 8.93 22.07 23.24 6.60 3.02 0.52 25.16 20.51 0.65 4.51 5.20 15.24 29.04 24.96 7.19 14.36 34.11 15.94 18.03 22.12 22.08 1.80 3.17 9.40 19.64 12.94 34.28 2.23 2.39 34.04 34.69 37.59 8.04 13.43 30.88 26.44 34.46 25.50 11.11 17.96 34.73 17.03 20.45 12.25 17.69 28.54 15.97 14.32 7.44 '
radii = '3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 3.00 '
width = '1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 '
rho_max = '0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 0.20 '
      variable_type = 'rhoscrewgnd'
	  slip_sys_index = 0
	  read_prop_user_object = prop_read
	  slip_sys_file_name = 'input_slip_sys.txt' # no need to normalize vectors
	  nss = 12
    [../]
  [../]
[]

[AuxVariables]
  [./temp]
    order = CONSTANT
    family = MONOMIAL
  [../]
  
  [./dislov]
    order = FIRST
    family = MONOMIAL
  [../] 

  [./ddislovdx]
    order = CONSTANT
    family = MONOMIAL
  [../] 
  
  [./ddislovdy]
    order = CONSTANT
    family = MONOMIAL
  [../] 

  [./stress_xz]
    order = CONSTANT
    family = MONOMIAL
  [../]

  [./gss1]
    order = CONSTANT
    family = MONOMIAL
  [../]

  [./fp_xz]
    order = CONSTANT
    family = MONOMIAL
  [../]
  
  [./bounds_dummy]
  [../]
[]

[Functions]
  [./temperature_load]
    type = PiecewiseLinear
    data_file = 'temp146us.csv'
    format = columns
  [../]
  [./disp_load]
   type = PiecewiseLinear
    data_file = 'ProjectedShear146.csv'
    format = columns
  [../]
  [./dts]
    type = PiecewiseConstant
    x = '0.0 3420.0'
    y = '1.0 1.0'
  [../]
[]

[UserObjects]
  [./prop_read]
    type = GrainPropertyReadFile
    prop_file_name = 'euler_ang_test.inp'
    # Enter file data as prop#1, prop#2, .., prop#nprop
    nprop = 3
    ngrain = 1
    read_type = indexgrain
  [../]
[]

[Kernels]
  [./TensorMechanics]
    displacements = 'disp_x disp_y disp_z'
    use_displaced_mesh = true
    add_variables = true
  [../]
  
  [./drho_t_dt]
    type = TimeDerivative
    variable = rho_t
  [../]
  [./rho_gnd_edge_advection]
    type = ConservativeAdvectionCoupled
    variable = rho_t
	rho_coupled = rho_gnd_edge
    upwinding_type = none
	slip_sys_index = 0
	dislo_sign = positive
	dislo_character = edge
  [../]
  [./rho_gnd_screw_advection]
    type = ConservativeAdvectionCoupled
    variable = rho_t
	rho_coupled = rho_gnd_screw
    upwinding_type = none
	slip_sys_index = 0
	dislo_sign = positive
	dislo_character = screw
  [../] 
  [./rho_t_curvature_mult]
    type = CurvatureMultiplication
    variable = rho_t
	curvature = q_t
	slip_sys_index = 0
	check_rho_positive = true
	rho_tot_tol = 0.02
  [../]
  
  [./drho_gnd_edge_dt]
    type = TimeDerivative
	variable = rho_gnd_edge
  [../]
  [./rho_t_advection_edge]
    type = ConservativeAdvectionCoupled
    variable = rho_gnd_edge
	rho_coupled = rho_t
    upwinding_type = none
	slip_sys_index = 0
	dislo_sign = positive
	dislo_character = edge
  [../]
  
  [./drho_gnd_screw_dt]
    type = TimeDerivative
	variable = rho_gnd_screw
  [../]
  [./rho_t_advection_screw]
    type = ConservativeAdvectionCoupled
    variable = rho_gnd_screw
	rho_coupled = rho_t
    upwinding_type = none
	slip_sys_index = 0
	dislo_sign = positive
	dislo_character = screw
  [../]
  
  [./dq_t_dt]
    type = TimeDerivative
    variable = q_t
  [../]
  [./curvature_advection_edge]
    type = CurvatureAdvection
	variable = q_t
	rho_gnd = rho_gnd_edge
	rho_tot = rho_t
	slip_sys_index = 0
	dislo_character = edge
	rho_tot_tol = 0.02
    check_gnd_rho_ratio = true
  [../]
  [./curvature_advection_screw]
    type = CurvatureAdvection
	variable = q_t
	rho_gnd = rho_gnd_screw
	rho_tot = rho_t
	slip_sys_index = 0
	dislo_character = screw
	rho_tot_tol = 0.02
    check_gnd_rho_ratio = true
  [../]
  [./A2TraceX]
    type = A2Trace
	variable = q_t
    rho_tot = rho_t
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = edge
	dv_dx_max = 0.1
	dv_dy_max = 0.1
  [../]
  [./A2TraceY]
    type = A2Trace
	variable = q_t
    rho_tot = rho_t
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = screw
	dv_dx_max = 0.1
	dv_dy_max = 0.1
  [../]
  [./A2deviatoricX]
    type = A2Deviatoric
	variable = q_t
	rho_gnd_edge = rho_gnd_edge
	rho_gnd_screw = rho_gnd_screw
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = edge	
	dv_dx_max = 0.1
	dv_dy_max = 0.1
	ksabs_tol = 0.0283
  [../]
  [./A2deviatoricY]
    type = A2Deviatoric
	variable = q_t	
	rho_gnd_edge = rho_gnd_edge
	rho_gnd_screw = rho_gnd_screw
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0	
	dislo_character = screw
	dv_dx_max = 0.1
	dv_dy_max = 0.1
	ksabs_tol = 0.0283
  [../]

  [./q_t_diffusion]
    type = CoefDiffusion
    variable = q_t
    coef = 0.001
  [../]
  [./rho_t_diffusion]
    type = CoefDiffusion
    variable = rho_t
     use_displaced_mesh = false
    coef = 0.001
  [../]
  [./rho_gnd_edge_diffusion]
    type = CoefDiffusion
    variable = rho_gnd_edge
        use_displaced_mesh = false
    coef = 0.001
  [../]
  [./rho_gnd_screw_diffusion]
    type = CoefDiffusion
    variable = rho_gnd_screw
        use_displaced_mesh = false
    coef = 0.001
  [../]
  
[]

[DGKernels]
  [./rho_t_advection_edge_DG]
    implicit = false
    type = DGAdvectionCoupledPN
    variable = rho_t
	rho_coupled = rho_gnd_edge
	slip_sys_index = 0
	dislo_character = edge
    is_edge_or_screw = false 
    rho_coupled_ot = rho_gnd_screw
  [../]
  [./rho_t_advection_screw_DG]
    implicit = false
    type = DGAdvectionCoupledPN
    variable = rho_t
	rho_coupled = rho_gnd_screw
	slip_sys_index = 0
	dislo_character = screw
    is_edge_or_screw = false	
    rho_coupled_ot = rho_gnd_edge
  [../]

  [./rho_gnd_edge_advection_DG]
    implicit = false
    type = DGAdvectionCoupledPN
    variable = rho_gnd_edge
	rho_coupled = rho_t
	slip_sys_index = 0
	dislo_character = edge
    is_edge_or_screw = true
    rho_coupled_ot = rho_gnd_screw
  [../] 
  
  [./rho_gnd_screw_advection_DG]
    implicit = false
	type = DGAdvectionCoupledPN
	variable = rho_gnd_screw
	rho_coupled = rho_t
	slip_sys_index = 0
	dislo_character = screw
    is_edge_or_screw = true
    rho_coupled_ot = rho_gnd_edge
  [../]

  [./curvature_advection_edge_DG]
    implicit = false
    type = DGCurvatureAdvectionPN
	variable = q_t
	rho_gnd = rho_gnd_edge
	rho_tot = rho_t
	slip_sys_index = 0
	dislo_character = edge
    rho_gnd_ot = rho_gnd_screw
	rho_tot_tol = 0.02
  [../]
  [./curvature_advection_screw_DG]
    implicit = false
    type = DGCurvatureAdvectionPN
	variable = q_t
	rho_gnd = rho_gnd_screw
	rho_tot = rho_t
	slip_sys_index = 0
	dislo_character = screw
    rho_gnd_ot = rho_gnd_edge
	rho_tot_tol = 0.02
  [../]
  [./A2TraceX_DG]
    implicit = false
    type = DGA2Trace
	variable = q_t
    rho_tot = rho_t
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = edge
	dv_dx_max = 0.1
	dv_dy_max = 0.1
  [../]
  [./A2TraceY_DG]
    implicit = false
    type = DGA2Trace
	variable = q_t
    rho_tot = rho_t
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = screw
	dv_dx_max = 0.1
	dv_dy_max = 0.1
  [../]
  [./A2deviatoricX_DG]
    implicit = false
    type = DGA2Deviatoric
	variable = q_t
	rho_gnd_edge = rho_gnd_edge
	rho_gnd_screw = rho_gnd_screw
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0
	dislo_character = edge	
	dv_dx_max = 0.1
	dv_dy_max = 0.1
	ksabs_tol = 0.0283
  [../]
  [./A2deviatoricY_DG]
    implicit = false
    type = DGA2Deviatoric
	variable = q_t	
	rho_gnd_edge = rho_gnd_edge
	rho_gnd_screw = rho_gnd_screw
	dv_dx = ddislovdx
	dv_dy = ddislovdy
	slip_sys_index = 0	
	dislo_character = screw	
	dv_dx_max = 0.1
	dv_dy_max = 0.1
	ksabs_tol = 0.0283
 [../]
[]

[AuxKernels]
  [./tempfuncaux]
    type = FunctionAux
    variable = temp
    function = temperature_load
  [../]
  
  [./dislov]
    type = MaterialStdVectorAux
    variable = dislov
    property = dislo_velocity
    index = 0
    execute_on = timestep_end
  [../]
  
  [./ddislovdx]
    type = DirectionalDerivative
    variable = ddislovdx
    gradient_variable = dislov
    slip_sys_index = 0
    dislo_character = edge
  [../]
 
  [./ddislovdy]
    type = DirectionalDerivative
    variable = ddislovdy
    gradient_variable = dislov
    slip_sys_index = 0
    dislo_character = screw
  [../]

  [./stress_xz]
    type = RankTwoAux
    variable = stress_xz
    rank_two_tensor = stress
    index_j = 2
    index_i = 0
    execute_on = timestep_end
  [../]

  [./gss1]
    type = MaterialStdVectorAux
    variable = gss1
    property = gss
    index = 0
    execute_on = timestep_end
  [../]

  [./fp_xz]
    type = RankTwoAux
    variable = fp_xz
    rank_two_tensor = fp
    index_j = 2
    index_i = 0
    execute_on = timestep_end
  [../]
[]

[BCs]
  [./z_back]
    type = DirichletBC
    variable = disp_z
    boundary = back
    value = 0.0
  [../]
  [./x_back]
    type = DirichletBC
    variable = disp_x
    boundary = back
    value = 0.0
  [../]
  [./y_back]
    type = DirichletBC
    variable = disp_y
    boundary = back
    value = 0.0
  [../]
  
  [./z_front]
    type = DirichletBC
    variable = disp_z
    boundary = front
    value = 0.0
  [../]
  [./y_front]
    type = DirichletBC
    variable = disp_y
    boundary = front
    value = 0.0
  [../]
  [./x_front]
    type = FunctionDirichletBC
    variable = disp_x
    boundary = front
    function = disp_load
  [../]
  
  [./Periodic]
    [./all_rho_t]
      variable = rho_t
      auto_direction = 'x y z'
    [../]
    [./all_rho_gnd_edge]
      variable = rho_gnd_edge
      auto_direction = 'x y z'
    [../]
    [./all_rho_gnd_screw]
      variable = rho_gnd_screw
      auto_direction = 'x y z'
    [../]
    [./all_q_t]
      variable = q_t
      auto_direction = 'x y z'
    [../]	
  [../] 

[]

[Materials]
  [./crysp]
    type = FiniteStrainCrystalPlasticityDislo
    slip_sys_file_name = 'input_slip_sys.txt' # no need to normalize vectors
    nss = 12 # Number of slip systems
    num_slip_sys_flowrate_props = 2 #Number of flow rate properties in a slip system
    flowprops =  '1 12 0.001 0.1' # slip rate equations parameters
	hprops = '1.0 3629.0 216.0 300.5 2.5' # hardening properties
    gprops = '1 12 216.0' # initial values of slip system resistances (start_slip_sys, end_slip_sys, value)
    tan_mod_type = exact
    thermal_expansion = '44.73e-6'
    reference_temperature = '303.0'
    temp = temp
    slip_incr_tol = 0.001
    maxiter = 200
    maxitergss = 200
    maximum_substep_iteration = 1
    gen_random_stress_flag = true
# Calibrated using table 1 in:
# M.R. DAYMOND and P.J. BOUCHARD
# Elastoplastic Deformation of 316 Stainless Steel Under
# Tensile Loading at Elevated Temperatures
# METALLURGICAL AND MATERIALS TRANSACTIONS A
# VOLUME 37A, JUNE 2006—1873
	dCRSS_dT_A = 0.53
	dCRSS_dT_B = 0.47
	dCRSS_dT_C = 0.008
# Hull, Bacon, Dislocations, figure 3.11a
	dislo_mobility = 0.04 # um/us/MPa
	burgers_vector_mag = 0.00025 # um
	shear_modulus_hardening = 86000.0 # MPa
    dislo_max_velocity = 0.04 # um/us
	rho_edge_pos_1 = rho_t
    bowout_coef = 0.5
    rho_v_thres_flag = false
  [../]
  [./elasticity_tensor]
    type = ComputeElasticityTensorCPGrain
# Elastic constants of 316L SS from:
# Clausen, B., Lorentzen, T. and Leffers, T. 
# Self-consistent modelling of the plastic
# deformation of FCC polycrystals and its implications for diffraction
# measurements of internal stresses.
# Acta Mater. 46, 3087–3098 (1998).
    C_ijkl = '2.046e5 1.377e5 1.377e5 2.046e5 1.377e5 2.046e5 1.262e5 1.262e5 1.262e5'
    fill_method = symmetric9
    read_prop_user_object = prop_read
    temp = temp
    dC11_dT = 0.0004415
    dC12_dT = 0.0003275
    dC44_dT = 0.0004103
  [../]
  [./strain]
    type = ComputeFiniteStrain
    displacements = 'disp_x disp_y disp_z'
  [../]
[]

[Bounds]
  [./lower_bound_rho_t]
    type = ConstantBoundsAux
    variable = bounds_dummy
    bounded_variable = rho_t
    bound_type = lower
    bound_value = 0.0
  [../]
[]

[Preconditioning]
  active = 'smp'
  [./smp]
    type = SMP
    full = true
  [../]
[]

[Executioner]

  type = Transient
  solve_type = 'PJFNK'
  
  petsc_options_iname = '-pc_type -pc_factor_mat_solver_package -snes_type'
  petsc_options_value = 'lu       superlu_dist                  vinewtonrsls'

  line_search = 'none'

  automatic_scaling = true
  
  l_max_its = 50
  nl_max_its = 20
  nl_rel_tol = 1e-6
  nl_abs_tol = 1e-8
  
  [./TimeStepper]
    type = FunctionDTGrowth
    function = dts
	cutback_factor_at_failure = 0.1
	growth_factor = 1.2
  [../]

  start_time = 0.0
  end_time = 1.0 # 3420.0 microseconds
  
  dtmin = 1.0e-20
  timestep_tolerance = 1.0e-20
[]

[Outputs]
  [./out]
    type = Exodus
    interval = 1 # 20
  [../]
[]
